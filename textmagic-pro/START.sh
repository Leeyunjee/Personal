#!/bin/bash

#############################################
#                                           #
#   âœ¨ TextMagic Pro - ì›í´ë¦­ ì‹¤í–‰          #
#                                           #
#   ì´ íŒŒì¼ì„ ë”ë¸”í´ë¦­í•˜ê±°ë‚˜                  #
#   í„°ë¯¸ë„ì—ì„œ ./START.sh ì‹¤í–‰               #
#                                           #
#############################################

cd "$(dirname "$0")"

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                â•‘"
echo "â•‘   âœ¨ TextMagic Pro - AI í…ìŠ¤íŠ¸ ë„êµ¬ ì„œë¹„ìŠ¤                     â•‘"
echo "â•‘                                                                â•‘"
echo "â•‘   ì›” \$400 ìˆ˜ìµ ì°½ì¶œ ìŠ¤íƒ€íŠ¸ì—…                                   â•‘"
echo "â•‘                                                                â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Node.js í™•ì¸
if ! command -v node &> /dev/null; then
    echo "âŒ Node.jsê°€ ì„¤ì¹˜ë˜ì–´ ìžˆì§€ ì•ŠìŠµë‹ˆë‹¤."
    echo ""
    echo "Node.jsë¥¼ ë¨¼ì € ì„¤ì¹˜í•´ì£¼ì„¸ìš”:"
    echo "https://nodejs.org/ko/download/"
    echo ""
    read -p "Press Enter to exit..."
    exit 1
fi

echo "âœ… Node.js ë²„ì „: $(node --version)"
echo ""

# ì˜ì¡´ì„± ì„¤ì¹˜ í™•ì¸
if [ ! -d "node_modules" ]; then
    echo "ðŸ“¦ ì²« ì‹¤í–‰: ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..."
    echo "   (ì•½ 1-2ë¶„ ì†Œìš”)"
    echo ""
    npm install
    echo ""
    echo "âœ… ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ!"
    echo ""
fi

# í™˜ê²½ ì„¤ì • íŒŒì¼ ìƒì„±
if [ ! -f ".env.local" ]; then
    echo "âš™ï¸  í™˜ê²½ ì„¤ì • íŒŒì¼ ìƒì„± ì¤‘..."
    JWT_SECRET=$(openssl rand -hex 32 2>/dev/null || node -e "console.log(require('crypto').randomBytes(32).toString('hex'))")
    cat > .env.local << EOF
JWT_SECRET=${JWT_SECRET}
OPENAI_API_KEY=
STRIPE_SECRET_KEY=
NEXT_PUBLIC_URL=http://localhost:3000
EOF
    echo "âœ… í™˜ê²½ ì„¤ì • íŒŒì¼ ìƒì„± ì™„ë£Œ"
    echo ""
fi

# ë°ì´í„° ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p data

echo "ðŸš€ ì„œë²„ ì‹œìž‘ ì¤‘..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… ì„œë²„ê°€ ê³§ ì‹œìž‘ë©ë‹ˆë‹¤!"
echo ""
echo "ðŸŒ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°: http://localhost:3000"
echo ""
echo "ðŸ’¡ ì‚¬ìš© ë°©ë²•:"
echo "   1. íšŒì›ê°€ìž… (ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸)"
echo "   2. ë¡œê·¸ì¸"
echo "   3. AI ë„êµ¬ ì‚¬ìš©!"
echo ""
echo "ðŸ“– ìˆ˜ìµí™” ê°€ì´ë“œ: GUIDE.txt íŒŒì¼ ì°¸ì¡°"
echo ""
echo "â¹ï¸  ì¢…ë£Œ: Ctrl+C"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# ì„œë²„ ì‹¤í–‰
npm run dev
